
@{
    ViewBag.Title = "ItemManageList2";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Styles.Render(Url.Content("~/Content/item_master.css"))
@Styles.Render(Url.Content("~/Content/themes/base/jquery-ui.min.css"))
@Styles.Render(Url.Content("~/Content/themes/base/jquery-ui.css"))

<div id="CmnContents">
    <div id="ComBlock">

        <div class="setListBox inlineSet iconSet iconList">
            <h1>商品情報一覧（商品管理）</h1>
            <div class="itemCmnSetKnr itemCmnSet resetValue searchBox">
                <h2>商品情報一覧検索</h2>

                <div ID="Panel1">
                    <table>
                        <tr>
                            <th title="Item Number">
                                商品番号<br>@Html.CheckBox("chkno")<span>完全</span>
                            </th>
                            <td>
                                @Html.TextArea("txtitemno")
                            </td>
                            <th title="Brand name">ブランド名</th>
                            <td>
                                @Html.TextBox("txtbrandname")
                            </td>
                            <th title="Catalog information">カタログ情報</th>
                            <td>
                                @Html.TextBox("txtcatinfo")
                            </td>
                            <th title="Person in charge">担当者</th>
                            <td>
                                @Html.DropDownList("ddlpersonincharge", new SelectList(Enumerable.Empty<SelectListItem>(), " ", " "), " ", new { @tabIndex = 4, onkeydown = "KeyDown(event,this)" })
                            </td>
                        </tr>
                        <tr>

                            <th title="SKS status">SKSステータス</th>
                            <td>
                                @Html.DropDownList("ddlsksstatus", new List<SelectListItem>
                                             { new SelectListItem{Text="ページ制作", Value="1"},
                                               new SelectListItem{Text="期日出品待ち", Value="2"},
                                               new SelectListItem{Text="出品待ち", Value="3"},
                                               new SelectListItem{Text="出品済", Value="4"}})

                            </td>
                            <th title="Date of approval">承認日</th>
                            <td class="cal">
                                @Html.TextBox("dtpFromDate","", new { onkeydown = "KeyDown(event,this)" })
                            </td>
                            <th title="Date of approval">~&nbsp;&nbsp;&nbsp;</th>
                            <td class="cal">
                                @Html.TextBox("dtpToDate","", new {onkeydown = "KeyDown(event,this)" })
                            </td>
                        </tr>
                    </table>
                    <div id="hideBlock">

                        <p>詳細検索</p>

                        <div id="hideBox">
                            <table>
                                <tr>
                                    <th>商品名</th>
                                    <td>
                                        @Html.TextBox("txtproductname")
                                    </td>
                                    <th>メーカー商品コード</th>
                                    <td>
                                        @Html.TextBox("txtmanproductcode")
                                    </td>
                                    <th>仕入先名</th>
                                    <td>
                                        @Html.TextBox("txtconmpanyname")
                                    </td>
                                    <th>競技名</th>
                                    <td>
                                        @Html.TextBox("txtcompetitionname")
                                    </td>
                                </tr>
                                <tr>
                                    <th>分類名</th>
                                    <td>
                                        @Html.TextBox("txtclassname")
                                    </td>
                                    <th>特記フラグ</th>
                                    <td>
                                        @Html.DropDownList("SpecialFlagCD", new SelectList(Enumerable.Empty<SelectListItem>(), " ", " "), " ", new { @tabIndex = 13, onkeydown = "KeyDown(event,this)" })
                                    </td>
                                    <th>予約フラグ</th>
                                    <td>
                                        @Html.DropDownList("ReservationFlagCD", new SelectList(Enumerable.Empty<SelectListItem>(), " ", " "), " ", new { @tabIndex = 14, onkeydown = "KeyDown(event,this)" })
                                    </td>
                                    <th>年度</th>
                                    <td>
                                        @Html.DropDownList("YearCD", new SelectList(Enumerable.Empty<SelectListItem>(), " ", " "), " ", new { tabIndex = 15, onkeydown = "KeyDown(event,this)" })
                                    </td>
                                </tr>
                                <tr>
                                    <th>シーズン</th>
                                    <td>
                                        @Html.DropDownList("SeasonCD", new SelectList(Enumerable.Empty<SelectListItem>(), " ", " "), " ", new { @tabIndex = 16, onkeydown = "KeyDown(event,this)" })
                                    </td>
                                    <th>ショップ<br />ステータス</th>
                                    <td>
                                        @Html.DropDownList("ddlshopstatus", new List<SelectListItem>
                                           {
                                             new SelectListItem{Text="未掲載", Value="n"},
                                             new SelectListItem{Text="掲載中", Value="u"},
                                             new SelectListItem{Text="掲載無", Value="g"},
                                             new SelectListItem{Text="倉庫", Value="w"},
                                             new SelectListItem{Text="エラー", Value="e"},
                                             new SelectListItem{Text="削除", Value="d"},
                                             new SelectListItem{Text="削・無のぞく", Value="nu"}})
                                    </td>
                                    <th>備考</th>
                                    <td>
                                        @Html.TextBox("txtremark")
                                    </td>
                                    <th>JANコード</th>
                                    <td>
                                        @Html.TextBox("txtjancode")
                                    </td>
                                </tr>
                                <tr>
                                    <th>販売管理コード </th>
                                    <td>
                                        @Html.TextBox("txtsalemanagementcode")
                                    </td>
                                    <th>指示書番号</th>
                                    <td>
                                        @Html.TextBox("txtinstrauctionno")
                                    </td>
                                </tr>

                            </table>
                        </div>
                    </div>
                    <p>
                        <input type="button" id="btnsearch" value="検 索" style="width:128px;" />
                    </p>
                </div>
            </div>


            <div class="widthhMax iconEx operationBtn">
                <p>
                    <input type="button" id="btnselectall" value="全て選択" />
                </p>
                <p>
                    <input type="button" id="btncancelall" value="全て解除" />
                </p>
                <p>
                    <input type="button" id="btnexhibition" value="出品" />
                </p>
                <p>
                    <input type="button" id="btnwarehouse" value="倉庫" />
                </p>
                <p>
                    <input type="button" id="btndelete" value="削除" />
                </p>
                <p>
                    <input type="button" id="btnGenerate" value="エクスポート" ToolTip="Export" />
                </p>

            </div>

            <div class="resetValue editBox">
                <table class="listTable" id="tbItemManage" style="width:100%;">
                    <thead>
                        <tr>
                            @*<th>対象</th>
                                <th>SKS <br /> ST</th>
                                <th>Shop <br /> ST</th>
                                <th>商品画像</th>*@
                            <th>商品番号</th>
                            <th>商品名</th>
                            <th>定価</th>
                            <th>販売価格</th>
                            <th>原価</th>
                            <th>原価率</th>
                            <th>割引率</th>
                            <th>SKU</th>
                            <th>ショップページ</th>
                            <th>送料</th>
                            <th>掲載可能日</th>
                            <th>発売日</th>
                            <th>競技名</th>
                            <th>分類名</th>
                            <th>ブランド名</th>
                            <th>仕入先名</th>
                            <th>年度</th>
                            <th>シーズン</th>
                            <th>カタログ情報</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

        </div>
    </div>
</div>

@section Scripts
{
    <script src="@Url.Content("~/Scripts/jquery-ui-1.12.1.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui-1.12.1.js")"></script>

    <script type="text/javascript">
        $(document).ready(function () {

           BindItemManageTable();
            BindUser();
            BindSpecialFlag();
            BindReservationFlag();
            BindYear();
            BindSeason();
            BindExportField();

            $("#dtpFromDate").datepicker({
                altFormat: "yy-mm-dd",
                dateFormat: "yy/mm/dd",
                showOn: "button",
                buttonImage: "/images/calendar.png",
                buttonImageOnly: true,
                showButtonPanel: true,
                isRTL: true,
            });

            $("#dtpToDate").datepicker({
                altFormat: "yy-mm-dd",
                dateFormat: "yy/mm/dd",
                showOn: "button",
                buttonImage: "/images/calendar.png",
                buttonImageOnly: true,
                showButtonPanel: true,
                isRTL: true,
            });

            $('#hideBlock p').on('click', function () {
                var hiddenbox = $(this).closest('#hideBlock p');
                if (this.hidden) {
                    // This row is already open - close it
                    $(this).next().slideToggle();
                    $(this).removeClass("active");
                }
                else {
                    // Open this row
                    $(this).next().slideToggle();
                    $(this).toggleClass("active");
                }
            });

        });

         function BindUser() {
            var obj = {
                UserID: null,
            };
            var response = CalltoApiController('@Url.Action("User_Select", "api/UserApi")', obj);
            var items = JSON.parse(response);

            $.each(items, function (i, item) {

                var UserID = item.UserID;
                $("#ddlpersonincharge").append(
                    $('<option></option>').val(UserID).html(item.UserName));
            });
        }
        function BindSpecialFlag() {
            var response = CalltoApiController('@Url.Action("SpecialFlag_Select", "api/ItemApi")');
            var items = JSON.parse(response);


            $.each(items, function (i, item) {

                var SpecialFlagCD = item.SpecialFlagCD;
                $("#SpecialFlagCD").append(
                    $('<option></option>').val(SpecialFlagCD).html(item.SpecialFlagName));
            });
        }

        function BindReservationFlag() {
            var response = CalltoApiController('@Url.Action("ReservationFlag_Select", "api/ItemApi")');
            var items = JSON.parse(response);

            $.each(items, function (i, item) {

                var ReservationFlagCD = item.ReservationFlagCD;
                $("#ReservationFlagCD").append(
                    $('<option></option>').val(ReservationFlagCD).html(item.ReservationFlagName));
            });
        }

        function BindYear() {
            var response = CalltoApiController('@Url.Action("Year_Select", "api/MultiApi")');
            var items = JSON.parse(response);

            $.each(items, function (i, item) {

                var YearCD = item.YearCD;
                $("#YearCD").append(
                    $('<option></option>').val(YearCD).html(item.Year));
            });
        }

        function BindSeason() {
            var response = CalltoApiController('@Url.Action("Season_Select", "api/MultiApi")');
            var items = JSON.parse(response);

            $.each(items, function (i, item) {

                var SeasonCD = item.SeasonCD;
                $("#SeasonCD").append(
                    $('<option></option>').val(SeasonCD).html(item.Season));
            });
        }

        function BindExportField() {
            var obj = {
                ExportType: "01",
            };
            var response = CalltoApiController('@Url.Action("ExportField_Select", "api/ShopApi")', obj);
            var items = JSON.parse(response);

            $.each(items, function (i, item) {

                var AutoID = item.AutoID;
                $("#AutoID").append(
                    $('<option></option>').val(AutoID).html(item.ExportName));
            });
        }


        function BindItemManageTable() {
            var obj = {
                BrandName: $("#BrandName").val(),
                ItemName: $("#ItemName").val(),
                MakerCD: $("#MakerCD").val(),
                MakerName: $("#MakerName").val(),
                YearCD: $("#YearCD").val(),
                SeasonCD: $("#SeasonCD").val(),
                CatalogInfo: $("#CatalogInfo").val(),
                ClassName: $("#ClassName").val(),
                CompetitionName: $("#CompetitionName").val(),
                };
                var response = CalltoApiController('@Url.Action("ItemManage_List", "api/ItemApi")', obj);
            table = $('#tbItemManage').DataTable({
                data: JSON.parse(response),                
                destroy: true,
                "dataSrc": " ",
                "searching": false,
                "ordering": false,
                "scrollX": true,
                "columns": [
                    { "data": "ItemCD"},
                    { "data": "ItemName"},
                    { "data": "ListPrice" },
                    { "data": "SalePrice" },
                    { "data": "Cost" },
                    { "data": "CostRate"},
                    { "data": "DistcountRate" },
                    { "data": "ItemCD" },
                    { "data": "ItemCD"},
                    { "data": "ItemCD"},
                    { "data": "AvailableDate" },
                    { "data": "ReleaseDate" },
                    { "data": "CompetitionName"},
                    { "data": "ClassName"},
                    { "data": "BrandName" },
                    { "data": "MakerName" },
                    { "data": "Year" },
                    { "data": "Season" },
                    { "data": "CatalogInfo" }
                ],
                "columnDefs": [
                    {
                        "targets": [2,3, 4, 5, 6],
                        "className": 'textAlign',
                    },
                    {
                        "targets": 2,
                        "data": "ListPrice",
                        "render": function (data, type, row) {
                            return data + '<br/>(' + row['ListPrice1'] + ')';
                        }
                    },
                    {
                        "targets": 3,
                        "data": "SalePrice",
                        "render": function (data, type, row) {
                            return data + '<br/>(' + row['SalePrice1'] + ')';
                        }
                    },
                    {
                        "targets": 4,
                        "data": "Cost",
                        "render": function (data, type, row) {
                            return data + '<br/>(' + row['Cost1'] + ')';
                        }
                    },
                    {
                        "targets": 7,
                        "data": "ItemCD",
                        "render": function (data) {
                            return '<input type="button" style="width:70px;" onclick="ShowSKUView(\'' + data + '\')" value="SKU表示">';
                        }
                    },
                    {
                        "targets": 8,
                        "data": "ItemCD",
                        "render": function (data, type, row) {
                            var jsonData = JSON.parse(row.TargetShop);
                            var $select = $("<select></select>", {
                            });
                            $.each(jsonData, function (x, y) {
                                var keys = Object.keys(y);
                                if (!x) {
                                    keys.forEach(function (key) {
                                        if (key != "ItemCD" && y[key] != false) {
                                            var $option = $("<option></option>", { "text": key, "value": key });
                                            $select.append($option);
                                        }
                                    });
                                }
                            });
                            return $select.prop("outerHTML");
                        }
                    }
                ]
            });
        }
    </script>
}




@**@